<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<div>
    <label>用户名称：<input type="text" id="pba" placeholder="请输入用户名称" /></label><br /><br />
    <label>生成邮箱：<input type="text" id="oba" readonly /></label>
    <label>生成ID：<input type="text" id="obb" readonly /></label>
</div>

<script type="text/javascript">
	//发布者
	function Publisher(obj){
		this.observers = [];  // ------------订阅者
		var state = obj.value;     //让该内容不能直接访问  ------新的内容

		//新增两个对于state的操作 获取/更新
		this.getState=function(){
			return state;
		}
		this.setState=function(value){
			state = value;
			this.notice(); // 内容更新后，通知所有订阅者。
		}
		this.obj = obj;

	}

	// 添加新的订阅者
	Publisher.prototype.addOb=function(observer){
		var flag = false;
		for (var i = this.observers.length - 1; i >= 0; i--) {
			if(this.observers[i]===observer){
				flag=true;
			}
		};
		if(!flag){
			this.observers.push(observer);
		}
		return this;
	}

	//订阅者取消订阅，删除订阅者
	Publisher.prototype.removeOb=function(observer){
		var observers = this.observers;
		for (var i = 0; i < observers.length; i++) {
			if(observers[i]===observer){
				observers.splice(i,1);
			}
		};
		return this;
	}

	// 通知订阅者
	Publisher.prototype.notice=function(){
		var observers = this.observers;
		for (var i = 0; i < observers.length; i++) {
			observers[i].update(this.getState());   // 发布者有新东西发布，通知所有观察者，并把内容穿过去
		};
	}

	//订阅者
	function Subscribe(obj){
		this.obj = obj;
		// 发布者消息传来，自己再做其他处理
		this.update = function(data){
			this.obj.value = data;
		};
	}

	//实际应用

    var pba = new Publisher(document.querySelector("#pba"));  // 发布者

    var oba = new Subscribe(document.querySelector("#oba")),  // 订阅者
		obb = new Subscribe(document.querySelector("#obb"));



	pba.addOb(oba);
	pba.addOb(obb);  //

	oba.update = function(state){

		this.obj.value = state+"@w3c.com";
	}
	obb.update = function(state){
		this.obj.value = "ID-"+state;
	}

	pba.obj.addEventListener('keyup',function(){
		pba.setState(this.value);
	});

</script>
</body>
</html>